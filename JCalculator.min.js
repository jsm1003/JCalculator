!function(){var n="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,r=(n.jc,Array.prototype),t=Object.prototype,e=(r.push,r.slice,t.toString),i=(t.hasOwnProperty,Array.isArray),o=Object.keys,u=Object.values?Object.values:function(n){return o(n).map(function(r){return n[r]})},c=(Object.create,function(n){return n instanceof c?n:this instanceof c?void(this._wrapped=n):new c(n)});function a(n,r,t){return c.isNoVal(n)||c.isNoVal(r)?c.isNoVal(n)?r:n:(t="max"==t?n>r:n<r)?n:r}function f(n,r){var t={};return c.isArray(r)?c.map(r,function(r){t[n+r]=r}):c.isObject(r)?c.forIn(r,function(n,r){t[n]=r}):c.isString(r)&&(t[n+r]=r),t}function s(n,r){var t={},e=n.length,i={};return c.map(n,function(n){c.isObjEmpty(r.colObj)||c.forIn(r.colObj,function(r,e){var i=c.isFunction(e)?e(n):n[e];t[r]=i}),c.isObjEmpty(r.sumObj)||c.forIn(r.sumObj,function(r,e){var i=c.isFunction(e)?e(n):n[e];t[r]?t[r]+=i||0:t[r]=i||0}),c.isObjEmpty(r.avgObj)||c.forIn(r.avgObj,function(r,e){i[r]||(i[r]=0);var o=c.isFunction(e)?e(n):n[e];t[r]?t[r]+=o||0:t[r]=o||0,(o||0==o)&&i[r]++}),c.isObjEmpty(r.maxObj)||c.forIn(r.maxObj,function(r,e){var i=c.isFunction(e)?e(n):n[e];t[r]=a(t[r],i,"max")}),c.isObjEmpty(r.minObj)||c.forIn(r.minObj,function(r,e){var i=c.isFunction(e)?e(n):n[e];t[r]=a(t[r],i,"min")}),c.isObjEmpty(r.countObj)||c.forIn(r.countObj,function(r,i){var o=c.isFunction(i)?i(n):n[i];switch(c.isUndefined(t[r])&&(t[r]=0),r){case"*"==i?r:"count_*":t[r]=e;break;default:c.isUndefined(o)||null==o||t[r]++}})}),c.forIn(r.avgObj,function(n,r){t[n]=t[n]/i[n]}),t}function l(n,r){if(!r)return n;if(c.isObject(r)&&!c.isFunction(r)){var t=o(r),e=u(r);n.sort(function(n,r){for(var i,o,u=t.length,c=0;c<u&&(i=t[c],o=e[c],n[i]===r[i]);c++);if(n[i]!==r[i]){if(n[i]>r[i]||void 0===r[i])return"desc"===o||"DESC"===o?-1:1;if(n[i]<r[i]||void 0===n[i])return"desc"===o||"DESC"===o?1:-1}return"desc"===o||"DESC"===o?r[i]-n[i]:n[i]-r[i]})}else c.isFunction(r)&&n.sort(r);return n}function p(n,r){if(!r&&0!=r)return n;var t=[],e=n.length,i=0;if(c.isNumber(r))e=r>e?e:r;else if(c.isArray(r)){if(r[0]>e)return[];r[0]<e&&(i=r[0]),e=r[0]+r[1]<e?r[0]+r[1]:e}for(;i<e;i++)t.push(n[i]);return t}"undefined"==typeof exports||exports.nodeType?n.jc=c:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=c),exports.jc=c),c.VERSION="1.0.0",c.map=function(n,r){return c.isArray(n)?n.map(r):[]},c.forIn=function(n,r){if(!c.isObject(n))return{};var t=0;for(var e in n)r(e,n[e],t),t++},c.filter=function(n,r){return c.isArray(n)?n.filter(r):[]},c.where=function(n,r){var t;if(c.isFunction(r))t=c.filter(n,r);else{if(!c.isObject(r))return[];t=c.filter(n,function(n){return o(r).every(function(t){return r[t]===n[t]})})}return t},c.limit=function(n,r){return p(n,r)},c.order=c.orderBy=function(n,r){return l(n,r)},c.tree=function(n,r){var t;r.children||(r.children="children"),c.isString(r.retain)?t=[r.retain,r.id,r.parent]:c.isArray(r.retain)?((t=r.retain).push(r.id),t.push(r.parent)):c.isObject(r.retain)?((t=r.retain)[r.id]=r.id,t[r.parent]=r.parent):n=c.extend(!0,[],n),t&&(n=c.sql({select:{col:t},from:n}));var e={},i=c.groupBy(n,function(n){return n[r.id]==r.root&&(e=n),n[r.parent]});return c.map(n,function(n){var t=n[r.id];i[t]&&(n[r.children]=i[t])}),c.isObjEmpty(e)&&(e[r.children]=i[r.root]),e},c.extend=function(){var n,r,t,e,i,o,u=arguments[0]||{},a=1,f=arguments.length,s=!1;for("boolean"==typeof u&&(s=u,u=arguments[1]||{},a++),"object"==typeof u||c.isFunction(u)||(u={}),f===a&&(u=this,--a);a<f;a++)if(null!=(n=arguments[a]))for(r in n)t=u[r],u!==(e=n[r])&&(s&&e&&(c.isObject(e)||(i=c.isArray(e)))?(i?(i=!1,o=t&&c.isArray(t)?t:[]):o=t&&c.isObject(t)?t:{},u[r]=c.extend(s,o,e)):void 0!==e&&(u[r]=e));return u},c.unique=function(n){if(!n||0==n.length)return n;var r={},t=[];c.map(n,function(n){var t=JSON.stringify(n);r[t]=n});return c.forIn(r,function(n,r){t.push(r)}),t},c.spaceFix=function(n,r){if(!n||0==n.length)return n;var t=[];n[0][r.key]-r.start>0&&((s={})[r.key]=r.start,c.map(r.zeroFill,function(n){s[n]=0}),n.unshift(s));n[n.length-1][r.key]<r.end&&((s={})[r.key]=r.end,c.map(r.zeroFill,function(n){s[n]=0}),n.push(s));for(var e=1,i=n.length;e<i&&!(e>1e4);e++){var o=n[e][r.key]-n[e-1][r.key];if(o<=r.space)t.push(n[e]);else{for(var u=r.space,a=0,f=o/r.space;a<f-1&&!(a>1e4);a++){var s;(s={})[r.key]=parseInt(n[e-1][r.key])+parseInt(u),c.map(r.zeroFill,function(n){s[n]=0}),t.push(s),u+=r.space}t.push(n[e])}}return t.unshift(n[0]),t},c.keyArray=function(n,r){if(!n||0==n.length)return n;var t={};return c.map(n,function(n,e){c.map(r,function(r,e){t[r]||(t[r]=[]),t[r].push(n[r])})}),t},c.keyBreak=function(n,r){if(!n||0==n.length)return n;var t=[],e=r.key,i=r.value;return c.map(n,function(n){c.map(r.break,function(o){var u={};u[e]=o,u[i]=n[o],c.map(r.retain,function(r){u[r]=n[r]}),t.push(u)})}),t},c.max=function(n,r){if(!n||0==n.length)return n;var t;if(c.isString(r)){var e=r;r=function(n){return n[e]}}else c.isUndefined(r)&&(r=function(n){return n});return c.map(n,function(n){var e=t?r(t):t,i=n?r(n):n;t=c.isNoVal(e)||c.isNoVal(i)?c.isNoVal(e)?n:t:e>i?t:n}),t},c.min=function(n,r){if(!n||0==n.length)return n;var t;if(c.isString(r)){var e=r;r=function(n){return n[e]}}else c.isUndefined(r)&&(r=function(n){return n});return c.map(n,function(n){var e=t?r(t):t,i=n?r(n):n;t=c.isNoVal(e)||c.isNoVal(i)?c.isNoVal(e)?n:t:e<i?t:n}),t},c.group=c.groupBy=function(n,r){if(!n||0==n.length)return n;var t={};return c.map(n,function(n,e){var i=[];c.isArray(r)?c.map(r,function(r,t){c.isFunction(r)?i.push(r(n)):i.push(n[r])}):c.isString(r)?i.push(n[r]):c.isFunction(r)&&(i=r(n,e)),t[i]||(t[i]=[]),t[i].push(n)}),t},c.sql=function(n){if(function(n){if(!n.from)throw new Error("From is not defined","Error from");if(!n.select)throw new Error("Select is not defined","Error select");!function(n){var r=n.select,t=n.groupBy;if(!(r.sum||r.avg||r.count||r.max||r.min))return;if(r.col&&!n.groupBy)return;var e=f("",r.col);e=u(e);var i=[],o=!1;c.isArray(t)?c.map(t,function(n,r){i.push(n)}):c.isString(t)?i.push(t):c.isFunction(t)&&(i=[t]);for(var a=0,s=e.length;a<s;a++){for(var l=0;l<s;l++){if(e[a]==i[l]){o=!0;break}if(c.isObject(e[a])&&c.isObject(i[l])&&String(e[a])===String(i[l])){o=!0;break}}if(!o)throw new Error("groupBy should contain select.col","Error groupBy");o=!1}}(n)}(n),0==n.from.length||!c.isArray(n.from))return[];var r,t,e,i,o,a,m=n.from;return t=m,r=(e=n.where)?c.where(t,e):t,i=r,o=n,c.forIn(o.select,function(n,r){a=!("col"==n)||a}),p(l(function(n,r){if(!r)throw new Error("Select is not defined","Error select");var t=[],e={};r.col&&(e.colObj=f("",r.col));r.sum&&(e.sumObj=f("sum_",r.sum));r.avg&&(e.avgObj=f("avg_",r.avg));r.max&&(e.maxObj=f("max_",r.max));r.min&&(e.minObj=f("min_",r.min));r.count&&(e.countObj=f("count_",r.count));c.isArray(n)?c.map(n,function(n,r){var i=s([n],e);t.push(i)}):c.forIn(n,function(n,r,i,o){var u=s(r,e);t.push(u)});return t}(function(n,r){if(!r)return n;var t={sumObj:{},avgObj:{},maxObj:{},minObj:{},countObj:{}},e={};return c.forIn(r,function(n,r){var e=n.split("_"),i=e.shift(),o=e.join("_");switch(o=o.replace(/[1-9a-zA-z_\$\@]+/g,function(n){return"row['"+n+"']"}),i){case"sum":t.sumObj[n]=function(n){return new Function("row","return "+o)(n)};break;case"avg":t.avgObj[n]=function(n){return new Function("row","return "+o)(n)};break;case"max":t.maxObj[n]=function(n){return new Function("row","return "+o)(n)};break;case"min":t.minObj[n]=function(n){return new Function("row","return "+o)(n)};break;case"count":t.countObj[n]=function(n){return new Function("row","return "+o)(n)}}}),c.forIn(n,function(n,i,o,u){var c,a=s(i,t);for(var f in r)if(foo=new Function("return "+a[f]+r[f]),!(c=foo()))break;c&&(e[n]=i)}),e}(o.groupBy||a?o.groupBy||o.select.col?c.group(i,o.groupBy):{table:i}:i,n.having),n.select),n.orderBy),n.limit)},c.isObjEmpty=function(n){for(var r in n)return!1;return!0},c.isNoVal=function(n){return c.isUndefined(n)||null==n||n!=n},c.isArray=i||function(n){return"[object Array]"===e.call(n)},c.isObject=function(n){return n instanceof Object},c.map(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(n){c["is"+n]=function(r){return e.call(r)==="[object "+n+"]"}}),c.isUndefined=function(n){return void 0===n},"function"==typeof define&&define.amd&&define("jc",[],function(){return c})}();